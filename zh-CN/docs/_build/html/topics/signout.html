

<!DOCTYPE html>
<html class="writer-html5" lang="zh" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Sign-out &mdash; IdentityServer4 1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Sign-out of External Identity Providers" href="signout_external_providers.html" />
    <link rel="prev" title="Windows Authentication" href="windows.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> IdentityServer4
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/big_picture.html">大图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/terminology.html">术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/specs.html">支持的规范</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/packaging.html">打包和构建</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/support.html">支持和咨询选项</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/test.html">演示服务器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/contributing.html">贡献</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/0_overview.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/1_client_credentials.html">使用客户端凭据保护 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/2_interactive_aspnetcore.html">使用 ASP.NET Core 的交互式应用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/3_aspnetcore_and_apis.html">ASP.NET Core 和 API 访问</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/4_javascript_client.html">添加 JavaScript 客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/5_entityframework.html">使用 EntityFramework Core 获取配置和操作数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/6_aspnet_identity.html">使用 ASP.NET Core Identity</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">主题</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="startup.html">Startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">定义资源</a></li>
<li class="toctree-l1"><a class="reference internal" href="clients.html">定义客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="signin.html">登录</a></li>
<li class="toctree-l1"><a class="reference internal" href="signin_external_providers.html">Sign-in with External Identity Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows.html">Windows Authentication</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sign-out</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#removing-the-authentication-cookie">Removing the authentication cookie</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notifying-clients-that-the-user-has-signed-out">Notifying clients that the user has signed-out</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sign-out-initiated-by-a-client-application">Sign-out initiated by a client application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="signout_external_providers.html">Sign-out of External Identity Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="signout_federated.html">Federated Sign-out</a></li>
<li class="toctree-l1"><a class="reference internal" href="federation_gateway.html">Federation Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="consent.html">Consent</a></li>
<li class="toctree-l1"><a class="reference internal" href="apis.html">Protecting APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto.html">Cryptography, Keys and HTTPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="grant_types.html">Grant Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="client_authentication.html">Client Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension_grants.html">Extension Grants</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource_owner.html">Resource Owner Password Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="refresh_tokens.html">Refresh Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference_tokens.html">Reference Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="persisted_grants.html">Persisted Grants</a></li>
<li class="toctree-l1"><a class="reference internal" href="pop.html">Proof-of-Possession Access Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="mtls.html">Mutual TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="request_object.html">Authorize Request Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_token_request_validation.html">Custom Token Request Validation and Issuance</a></li>
<li class="toctree-l1"><a class="reference internal" href="cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="discovery.html">Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="add_apis.html">Adding more API Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="add_protocols.html">Adding new Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">端点</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/discovery.html">Discovery Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/authorize.html">Authorize Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/token.html">Token Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/userinfo.html">UserInfo Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/device_authorization.html">Device Authorization Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/introspection.html">Introspection Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/revocation.html">Revocation Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/endsession.html">End Session Endpoint</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/options.html">IdentityServer Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/identity_resource.html">Identity Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api_scope.html">API Scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api_resource.html">API Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/grant_validation_result.html">GrantValidationResult</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/profileservice.html">Profile Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/interactionservice.html">IdentityServer Interaction Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/deviceflow_interactionservice.html">Device Flow Interaction Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/ef.html">Entity Framework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/aspnet_identity.html">ASP.NET Identity Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">杂项</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/blogs.html">Blog posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/videos.html">Videos</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IdentityServer4</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Sign-out</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/topics/signout.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sign-out">
<h1>Sign-out<a class="headerlink" href="#sign-out" title="永久链接至标题">¶</a></h1>
<p>Signing out of IdentityServer is as simple as removing the authentication cookie,
but for doing a complete federated sign-out, we must consider signing the user out of the client applications (and maybe even up-stream identity providers) as well.</p>
<div class="section" id="removing-the-authentication-cookie">
<h2>Removing the authentication cookie<a class="headerlink" href="#removing-the-authentication-cookie" title="永久链接至标题">¶</a></h2>
<p>To remove the authentication cookie, simply use the <code class="docutils literal notranslate"><span class="pre">SignOutAsync</span></code> extension method on the <code class="docutils literal notranslate"><span class="pre">HttpContext</span></code>.
You will need to pass the scheme used (which is provided by <code class="docutils literal notranslate"><span class="pre">IdentityServerConstants.DefaultCookieAuthenticationScheme</span></code> unless you have changed it):</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">SignOutAsync</span><span class="p">(</span><span class="n">IdentityServerConstants</span><span class="p">.</span><span class="n">DefaultCookieAuthenticationScheme</span><span class="p">);</span>
</pre></div>
</div>
<p>Or you can use the convenience extension method that is provided by IdentityServer:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">SignOutAsync</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>Typically you should prompt the user for signout (meaning require a POST), otherwise an attacker could hotlink to your logout page causing the user to be automatically logged out.</p>
</div>
</div>
<div class="section" id="notifying-clients-that-the-user-has-signed-out">
<h2>Notifying clients that the user has signed-out<a class="headerlink" href="#notifying-clients-that-the-user-has-signed-out" title="永久链接至标题">¶</a></h2>
<p>As part of the signout process you will want to ensure client applications are informed that the user has signed out.
IdentityServer supports the <a class="reference external" href="https://openid.net/specs/openid-connect-frontchannel-1_0.html">front-channel</a> specification for server-side clients (e.g. MVC),
the <a class="reference external" href="https://openid.net/specs/openid-connect-backchannel-1_0.html">back-channel</a>  specification for server-side clients (e.g. MVC),
and the <a class="reference external" href="https://openid.net/specs/openid-connect-session-1_0.html">session management</a> specification for browser-based JavaScript clients (e.g. SPA, React, Angular, etc.).</p>
<p><strong>Front-channel server-side clients</strong></p>
<p>To signout the user from the server-side client applications via the front-channel spec, the &quot;logged out&quot; page in IdentityServer must render an <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code> to notify the clients that the user has signed out.
Clients that wish to be notified must have the <code class="docutils literal notranslate"><span class="pre">FrontChannelLogoutUri</span></code> configuration value set.
IdentityServer tracks which clients the user has signed into, and provides an API called <code class="docutils literal notranslate"><span class="pre">GetLogoutContextAsync</span></code> on the <code class="docutils literal notranslate"><span class="pre">IIdentityServerInteractionService</span></code> (<a class="reference internal" href="../reference/interactionservice.html#refinteractionservice"><span class="std std-ref">details</span></a>).
This API returns a <code class="docutils literal notranslate"><span class="pre">LogoutRequest</span></code> object with a <code class="docutils literal notranslate"><span class="pre">SignOutIFrameUrl</span></code> property that your logged out page must render into an <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code>.</p>
<p><strong>Back-channel server-side clients</strong></p>
<p>To signout the user from the server-side client applications via the back-channel spec the <code class="docutils literal notranslate"><span class="pre">IBackChannelLogoutService</span></code> service can be used.
IdentityServer will automatically use this service when your logout page removes the user's authentication cookie via a call to <code class="docutils literal notranslate"><span class="pre">HttpContext.SignOutAsync</span></code>.
Clients that wish to be notified must have the <code class="docutils literal notranslate"><span class="pre">BackChannelLogoutUri</span></code> configuration value set.</p>
<p><strong>Browser-based JavaScript clients</strong></p>
<p>Given how the <a class="reference external" href="https://openid.net/specs/openid-connect-session-1_0.html">session management</a> specification is designed, there is nothing special in IdentityServer that you need to do to notify these clients that the user has signed out.
The clients, though, must perform monitoring on the <cite>check_session_iframe</cite>, and this is implemented by the <a class="reference external" href="https://github.com/IdentityModel/oidc-client-js/">oidc-client JavaScript library</a>.</p>
</div>
<div class="section" id="sign-out-initiated-by-a-client-application">
<h2>Sign-out initiated by a client application<a class="headerlink" href="#sign-out-initiated-by-a-client-application" title="永久链接至标题">¶</a></h2>
<p>If sign-out was initiated by a client application, then the client first redirected the user to the <a class="reference internal" href="../endpoints/endsession.html#refendsession"><span class="std std-ref">end session endpoint</span></a>.
Processing at the end session endpoint might require some temporary state to be maintained (e.g. the client's post logout redirect uri) across the redirect to the logout page.
This state might be of use to the logout page, and the identifier for the state is passed via a <cite>logoutId</cite> parameter to the logout page.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">GetLogoutContextAsync</span></code> API on the <a class="reference internal" href="../reference/interactionservice.html#refinteractionservice"><span class="std std-ref">interaction service</span></a> can be used to load the state.
Of interest on the <code class="docutils literal notranslate"><span class="pre">LogoutRequest</span></code> model context class is the <code class="docutils literal notranslate"><span class="pre">ShowSignoutPrompt</span></code> which indicates if the request for sign-out has been authenticated, and therefore it's safe to not prompt the user for sign-out.</p>
<p>By default this state is managed as a protected data structure passed via the <cite>logoutId</cite> value.
If you wish to use some other persistence between the end session endpoint and the logout page, then you can implement <code class="docutils literal notranslate"><span class="pre">IMessageStore&lt;LogoutMessage&gt;</span></code> and register the implementation in DI.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="signout_external_providers.html" class="btn btn-neutral float-right" title="Sign-out of External Identity Providers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="windows.html" class="btn btn-neutral float-left" title="Windows Authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2020, Brock Allen &amp; Dominick Baier.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>