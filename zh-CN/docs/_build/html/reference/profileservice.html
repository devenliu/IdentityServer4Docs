

<!DOCTYPE html>
<html class="writer-html5" lang="zh" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Profile Service &mdash; IdentityServer4 1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="IdentityServer Interaction Service" href="interactionservice.html" />
    <link rel="prev" title="GrantValidationResult" href="grant_validation_result.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> IdentityServer4
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/big_picture.html">大图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/terminology.html">术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/specs.html">支持的规范</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/packaging.html">打包和构建</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/support.html">支持和咨询选项</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/test.html">演示服务器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/contributing.html">贡献</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/0_overview.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/1_client_credentials.html">使用客户端凭据保护 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/2_interactive_aspnetcore.html">使用 ASP.NET Core 的交互式应用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/3_aspnetcore_and_apis.html">ASP.NET Core 和 API 访问</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/4_javascript_client.html">添加 JavaScript 客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/5_entityframework.html">使用 EntityFramework Core 获取配置和操作数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/6_aspnet_identity.html">使用 ASP.NET Core Identity</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">主题</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/startup.html">Startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/resources.html">定义资源</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/clients.html">定义客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/signin.html">登录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/signin_external_providers.html">使用外部身份提供商登录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/windows.html">Windows 身份验证</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/signout.html">Sign-out</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/signout_external_providers.html">Sign-out of External Identity Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/signout_federated.html">Federated Sign-out</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/federation_gateway.html">Federation Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/consent.html">Consent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/apis.html">Protecting APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/crypto.html">Cryptography, Keys and HTTPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/grant_types.html">Grant Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/client_authentication.html">Client Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/extension_grants.html">Extension Grants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/resource_owner.html">Resource Owner Password Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/refresh_tokens.html">Refresh Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/reference_tokens.html">Reference Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/persisted_grants.html">Persisted Grants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/pop.html">Proof-of-Possession Access Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/mtls.html">Mutual TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/request_object.html">Authorize Request Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/custom_token_request_validation.html">Custom Token Request Validation and Issuance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/discovery.html">Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/add_apis.html">Adding more API Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/add_protocols.html">Adding new Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/tools.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">端点</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/discovery.html">Discovery Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/authorize.html">Authorize Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/token.html">Token Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/userinfo.html">UserInfo Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/device_authorization.html">Device Authorization Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/introspection.html">Introspection Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/revocation.html">Revocation Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../endpoints/endsession.html">End Session Endpoint</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">参考</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="options.html">IdentityServer Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="identity_resource.html">Identity Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_scope.html">API Scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_resource.html">API Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="grant_validation_result.html">GrantValidationResult</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Profile Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#iprofileservice-apis">IProfileService APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#profiledatarequestcontext">ProfileDataRequestContext</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requested-scopes-and-claims-mapping">Requested scopes and claims mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#isactivecontext">IsActiveContext</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interactionservice.html">IdentityServer Interaction Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="deviceflow_interactionservice.html">Device Flow Interaction Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="ef.html">Entity Framework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="aspnet_identity.html">ASP.NET Identity Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">杂项</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/blogs.html">Blog posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/videos.html">Videos</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IdentityServer4</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Profile Service</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/reference/profileservice.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="profile-service">
<h1>Profile Service<a class="headerlink" href="#profile-service" title="永久链接至标题">¶</a></h1>
<p>Often IdentityServer requires identity information about users when creating tokens or when handling requests to the userinfo or introspection endpoints.
By default, IdentityServer only has the claims in the authentication cookie to draw upon for this identity data.</p>
<p>It is impractical to put all of the possible claims needed for users into the cookie, so IdentityServer defines an extensibility point for allowing claims to be dynamically loaded as needed for a user.
This extensibility point is the <code class="docutils literal notranslate"><span class="pre">IProfileService</span></code> and it is common for a developer to implement this interface to access a custom database or API that contains the identity data for users.</p>
<div class="section" id="iprofileservice-apis">
<h2>IProfileService APIs<a class="headerlink" href="#iprofileservice-apis" title="永久链接至标题">¶</a></h2>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">GetProfileDataAsync</span></code></dt><dd><p>The API that is expected to load claims for a user. It is passed an instance of <code class="docutils literal notranslate"><span class="pre">ProfileDataRequestContext</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">IsActiveAsync</span></code></dt><dd><p>The API that is expected to indicate if a user is currently allowed to obtain tokens. It is passed an instance of <code class="docutils literal notranslate"><span class="pre">IsActiveContext</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="profiledatarequestcontext">
<h2>ProfileDataRequestContext<a class="headerlink" href="#profiledatarequestcontext" title="永久链接至标题">¶</a></h2>
<p>Models the request for user claims and is the vehicle to return those claims. It contains these properties:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Subject</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">ClaimsPrincipal</span></code> modeling the user.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Client</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">Client</span></code> for which the claims are being requested.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">RequestedClaimTypes</span></code></dt><dd><p>The collection of claim types being requested.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Caller</span></code></dt><dd><p>An identifier for the context in which the claims are being requested (e.g. an identity token, an access token, or the user info endpoint). The constant <code class="docutils literal notranslate"><span class="pre">IdentityServerConstants.ProfileDataCallers</span></code> contains the different constant values.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">IssuedClaims</span></code></dt><dd><p>The list of <code class="docutils literal notranslate"><span class="pre">Claim</span></code> s that will be returned. This is expected to be populated by the custom <code class="docutils literal notranslate"><span class="pre">IProfileService</span></code> implementation.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AddRequestedClaims</span></code></dt><dd><p>Extension method on the <code class="docutils literal notranslate"><span class="pre">ProfileDataRequestContext</span></code> to populate the <code class="docutils literal notranslate"><span class="pre">IssuedClaims</span></code>, but first filters the claims based on <code class="docutils literal notranslate"><span class="pre">RequestedClaimTypes</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="requested-scopes-and-claims-mapping">
<h2>Requested scopes and claims mapping<a class="headerlink" href="#requested-scopes-and-claims-mapping" title="永久链接至标题">¶</a></h2>
<p>The scopes requested by the client control what user claims are returned in the tokens to the client.
The <code class="docutils literal notranslate"><span class="pre">GetProfileDataAsync</span></code> method is responsible for dynamically obtaining those claims based on the <code class="docutils literal notranslate"><span class="pre">RequestedClaimTypes</span></code> collection on the <code class="docutils literal notranslate"><span class="pre">ProfileDataRequestContext</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">RequestedClaimTypes</span></code> collection is populated based on the user claims defined on the <a class="reference internal" href="../topics/resources.html#refresources"><span class="std std-ref">resources</span></a> that model the scopes.
If requesting an identity token and the scopes requested are an <a class="reference internal" href="identity_resource.html#refidentityresource"><span class="std std-ref">identity resources</span></a>, then the claims in the <code class="docutils literal notranslate"><span class="pre">RequestedClaimTypes</span></code> will be populated based on the user claim types defined in the <code class="docutils literal notranslate"><span class="pre">IdentityResource</span></code>.
If requesting an access token and the scopes requested are an <a class="reference internal" href="api_resource.html#refapiresource"><span class="std std-ref">API resources</span></a>, then the claims in the <code class="docutils literal notranslate"><span class="pre">RequestedClaimTypes</span></code> will be populated based on the user claim types defined in the <code class="docutils literal notranslate"><span class="pre">ApiResource</span></code> and/or the <code class="docutils literal notranslate"><span class="pre">Scope</span></code>.</p>
</div>
<div class="section" id="isactivecontext">
<h2>IsActiveContext<a class="headerlink" href="#isactivecontext" title="永久链接至标题">¶</a></h2>
<p>Models the request to determine if the user is currently allowed to obtain tokens. It contains these properties:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Subject</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">ClaimsPrincipal</span></code> modeling the user.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Client</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">Client</span></code> for which the claims are being requested.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Caller</span></code></dt><dd><p>An identifier for the context in which the claims are being requested (e.g. an identity token, an access token, or the user info endpoint). The constant <code class="docutils literal notranslate"><span class="pre">IdentityServerConstants.ProfileDataCallers</span></code> contains the different constant values.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">IsActive</span></code></dt><dd><p>The flag indicating if the user is allowed to obtain tokens. This is expected to be assigned by the custom <code class="docutils literal notranslate"><span class="pre">IProfileService</span></code> implementation.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="interactionservice.html" class="btn btn-neutral float-right" title="IdentityServer Interaction Service" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="grant_validation_result.html" class="btn btn-neutral float-left" title="GrantValidationResult" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2020, Brock Allen &amp; Dominick Baier.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>